<html>

<head>
   <meta charset="utf-8">
   <link rel="stylesheet" href="/style.css">
   <script src="/jquery-3.7.1.js"></script>
   <script src="/jquery.redirect.js"></script>
   <script src="/superadmin.js"></script>
</head>

<style>
   .content-area {
      background-color: #f09537;
      min-height: calc(100vh - 100px);
      padding-bottom: 20px;
      margin-top: 10px;
   }

   /* Modal Styles */
   .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
   }

   .modal-overlay.show {
      display: flex;
   }

   .modal-container {
      background-color: #2a2a2a;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      text-align: center;
      max-width: 500px;
      width: 90%;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
   }

   .modal-icon {
      font-size: 48px;
      margin-bottom: 20px;
   }

   .modal-title {
      font-size: 24px;
      margin-bottom: 10px;
      color: #fff;
   }

   .modal-message {
      color: #ccc;
      margin-bottom: 30px;
      font-size: 16px;
      line-height: 1.5;
   }

   .modal-btn {
      background-color: #4285f4;
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3);
      text-align: center;
      width: auto;
      float: none;
      margin-left: 0;
   }

   .modal-btn:hover {
      background-color: #357ae8;
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(66, 133, 244, 0.4);
   }

   .modal-btn:active {
      transform: translateY(0);
   }

   .modal-btn.error {
      background-color: #f44336;
      box-shadow: 0 4px 6px rgba(244, 67, 54, 0.3);
   }

   .modal-btn.error:hover {
      background-color: #da190b;
      box-shadow: 0 6px 10px rgba(244, 67, 54, 0.4);
   }

   .wrapper h2 {
      color: white;
      font-size: 18px;
   }

   .form-row {
      margin: 15px 0;
   }

   .form-row label {
      display: inline-block;
      width: 200px;
      font-weight: bold;
      color: #fff;
   }

   .form-row input, .form-row select {
      width: 300px;
      padding: 5px;
   }

   .section {
      display: none;
   }

   .section.active {
      display: block;
   }

   .menu a {
      cursor: pointer;
   }

   .content-area .row.header {
      background: #f0750f;
   }

   .event-list {
      border: 1px solid #ccc;
      background: white;
      padding: 10px;
      margin: 10px 0;
      max-height: 300px;
      overflow-y: auto;
   }

   .event-item {
      background: #f0f0f0;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #999;
      display: flex;
      justify-content: space-between;
      align-items: center;
   }

   .event-controls {
      display: flex;
      gap: 5px;
   }

   .event-btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 3px 8px;
      cursor: pointer;
      font-size: 12px;
      border-radius: 3px;
   }

   .event-btn.delete {
      background: #f44336;
   }

   .event-btn:hover {
      opacity: 0.8;
   }

   /* Hide file input text */
   input[type="file"]::file-selector-button {
      background-color: #4285f4;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
   }

   input[type="file"]::file-selector-button:hover {
      background-color: #357ae8;
   }

   input[type="file"] {
      color: transparent;
   }
</style>

<body>
   <div class="title">
      <span class="racing-icon-small">üèÅ</span>
      iRaceResults Super Admin
      <span style="float: right; font-size: 14px; margin-right: 20px;">Logged in as: <span id="user-name"></span><span>&nbsp;|&nbsp;<a href="/auth/logout">logout</a></span></span>
   </div>
   <div class="menu">
      <span class="menuitem active"><a href="#" id="btn-leagues">Leagues</a></span>
      <span class="menuitem"><a href="#" id="btn-points">Points</a></span>
      <span class="menuitem"><a href="#" id="btn-scoring">Scoring</a></span>
      <span class="menuitem"><a href="#" id="btn-rounds">Rounds</a></span>
      <span class="menuitem"><a href="#" id="btn-classes">Classes</a></span>
      <span class="menuitem"><a href="#" id="btn-tracks">Tracks</a></span>
   </div>

   <div class="content-area">
   <div style="padding: 20px;">

      <!-- Leagues Section -->
      <div id="section-leagues" class="section active">
         <h2 style="color: white;">Leagues</h2>
         <div class="table" id="leagues_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">League ID</div>
               <div class="cell">League Name</div>
               <div class="cell">League Status</div>
               <div class="cell">Actions &nbsp; <span id="add_league_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Add/Edit League Modal -->
         <div id="league_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="league_modal_title" style="color: white; text-align: left; margin-left: 20px;">Add New League</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="new_league_id">League ID:</label>
                     <input type="text" id="new_league_id" placeholder="e.g., NXTGT3S9" maxlength="10">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="new_league_name">League Name:</label>
                     <input type="text" id="new_league_name" placeholder="e.g., NXT Gen GT3 Season 9">
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_league_btn">Save</button>
                     <button class="modal-btn error" id="cancel_league_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Points Section -->
      <div id="section-points" class="section">
         <h2 style="color: white;">Points Type Configuration</h2>
         This is where you can configure the points systems for each league.  Position Scores list the points obtained for each position (first number in list = points for P1, etc.) <br>No points are allocated if there is no number in the Position scores list for that postiion.
         <div class="form-row">
            <label for="league_select_points">Select League:</label>
            <select id="league_select_points"></select>
         </div>
         <div class="table" id="points_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">No.</div>
               <div class="cell">Points Type</div>
               <div class="cell">Method</div>
               <div class="cell">Min Lap Ratio</div>
               <div class="cell">Position Scores</div>
               <div class="cell">Actions &nbsp; <span id="add_points_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Add/Edit Points Modal -->
         <div id="points_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="points_modal_title" style="color: white; text-align: left; margin-left: 20px;">Edit Points System</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="points_scoring_category">Scoring Category:</label>
                     <input type="text" id="points_scoring_category">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="points_scoring_type">Scoring Type:</label>
                     <input type="text" id="points_scoring_type">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="points_min_lap_ratio">Min Lap Ratio:</label>
                     <input type="number" step="0.01" id="points_min_lap_ratio" style="width: 100px;">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="points_position_scores">Position Scores (comma-separated):</label>
                     <input type="text" id="points_position_scores" placeholder="e.g., 25,18,15,12,10">
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_points_btn">Save</button>
                     <button class="modal-btn error" id="cancel_points_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Scoring Section -->
      <div id="section-scoring" class="section">
         <h2 style="color: white;">Scoring Types</h2>
         <p>This is where you can configure the scoring Types for each league. Each round uses one ore more scoring type. <br> Each scoring type uses one or more Points Types.  Configure the Points Types using the <b>points</b> menu item before editing this list </p>
         <div class="form-row">
            <label for="league_select_scoring">Select League:</label>
            <select id="league_select_scoring"></select>
         </div>
         <div class="table" id="scoring_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">No.</div>
               <div class="cell">Score Type</div>
               <div class="cell">Scored Events</div>
               <div class="cell">Actions &nbsp; <span id="add_scoring_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Add/Edit Scoring Modal -->
         <div id="scoring_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 700px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="scoring_modal_title" style="color: white; text-align: left; margin-left: 20px;">Edit Scoring Type</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="scoring_score_type">Score Type:</label>
                     <input type="text" id="scoring_score_type" placeholder="e.g., Overall">
                  </div>

                  <div style="margin-left: 20px; text-align: left;">
                     <label style="display: block; font-weight: bold; color: #fff; margin-bottom: 10px;">Score Events:</label>
                     <div id="score_events_list" class="event-list"></div>
                     <button class="modal-btn" id="add_event_btn" style="margin-top: 10px;">+ Add Event</button>
                  </div>

                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_scoring_btn">Save</button>
                     <button class="modal-btn error" id="cancel_scoring_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>

         <!-- Add/Edit Event Modal -->
         <div id="event_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="event_modal_title" style="color: white; text-align: left; margin-left: 20px;">Add Event</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="event_score_event">Event Name:</label>
                     <input type="text" id="event_score_event" placeholder="e.g., Race">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="event_simsession_name">Session Type:</label>
                     <select id="event_simsession_name" style="width: 150px;">
                        <option value="QUALIFY">QUALIFY</option>
                        <option value="RACE">RACE</option>
                     </select>
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="event_scoring_system">Points Type (index):</label>
                     <select id="event_scoring_system" style="width: 300px;"></select>
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_event_btn">Save</button>
                     <button class="modal-btn error" id="cancel_event_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Rounds Section -->
      <div id="section-rounds" class="section">
         <h2 style="color: white;">Rounds Configuration</h2>
         This is where you can configure the rounds for each league.  Each round references one or more scoring types defined in the <b>Scoring</b> menu item.
         <div class="form-row">
            <label for="league_select_rounds">Select League:</label>
            <select id="league_select_rounds"></select>
         </div>
         <div class="table" id="rounds_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">Round No</div>
               <div class="cell">Track Name</div>
               <div class="cell">Start Time</div>
               <div class="cell">Subsession IDs</div>
               <div class="cell">Score Types</div>
               <div class="cell">Actions &nbsp; <span id="add_round_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Add/Edit Round Modal -->
         <div id="round_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="round_modal_title" style="color: white; text-align: left; margin-left: 20px;">Edit Round</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="round_number">Round Number:</label>
                     <input type="number" id="round_number" style="width: 100px;">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="round_track_name">Track Name:</label>
                     <input type="text" id="round_track_name">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="round_start_time">Start Time (ISO format):</label>
                     <input type="text" id="round_start_time" placeholder="2025-11-06T20:00:00Z">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="round_subsession_ids">Subsession IDs (comma-separated):</label>
                     <input type="text" id="round_subsession_ids" placeholder="0">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="round_score_types">Score Types (comma-separated):</label>
                     <input type="text" id="round_score_types" placeholder="0">
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_round_btn">Save</button>
                     <button class="modal-btn error" id="cancel_round_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Classes Section -->
      <div id="section-classes" class="section">
         <h2 style="color: white;">Classes Configuration</h2>
         <div class="form-row">
            <label for="league_select_classes">Select League:</label>
            <select id="league_select_classes"></select>
         </div>
         <div class="table" id="classes_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">Class Number</div>
               <div class="cell">Class Name</div>
               <div class="cell">Position Score By</div>
               <div class="cell">Display in Tables</div>
               <div class="cell">Actions &nbsp; <span id="add_class_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Edit/Add Class Form Modal -->
         <div id="class_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="class_modal_title" style="color: white; text-align: left; margin-left: 20px;">Edit Class</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="class_number">Class Number:</label>
                     <input type="number" id="class_number" style="width: 100px;">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="class_name">Class Name:</label>
                     <input type="text" id="class_name">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="position_score_by">Position Score By:</label>
                     <select id="position_score_by" style="width: 150px;">
                        <option value="class">class</option>
                        <option value="overall">overall</option>
                     </select>
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="display_in_tables">Display in Tables:</label>
                     <input type="checkbox" id="display_in_tables" style="width: auto;">
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_class_btn">Save</button>
                     <button class="modal-btn error" id="cancel_class_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Tracks Section -->
      <div id="section-tracks" class="section">
         <h2 style="color: white;">Tracks Configuration</h2>
         <p>Manage the list of available tracks and their track maps. The short name is used in the rounds configuration and as the filename for the track map PNG.</p>
         <div style="text-align: left; margin-bottom: 10px;">
            <a href="#" id="validate_trackmaps_link" style="color: white; text-decoration: underline; cursor: pointer; font-weight: bold;">Validate Trackmap Availability</a>
         </div>
         <div class="table" id="tracks_table" style="width: 70%;">
            <div class="row header blue">
               <div class="cell">Full Track Name</div>
               <div class="cell">Short Name</div>
               <div class="cell">Actions &nbsp; <span id="add_track_btn" style="cursor: pointer; color: black;"><b>+ Add</b></span></div>
            </div>
         </div>

         <!-- Add/Edit Track Modal -->
         <div id="track_modal_overlay" class="modal-overlay">
            <div class="modal-container" style="background-color: #f09537; max-width: 600px; border-radius: 0; border: 3px solid white;">
               <h2 class="modal-title" id="track_modal_title" style="color: white; text-align: left; margin-left: 20px;">Edit Track</h2>
               <div class="wrapper" style="background-color: #f09537; color: #000;">
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="track_full_name">Full Track Name:</label>
                     <input type="text" id="track_full_name" placeholder="e.g., Circuit de Spa-Francorchamps">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="track_short_name">Short Name:</label>
                     <input type="text" id="track_short_name" placeholder="e.g., Spa" maxlength="20">
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label style="vertical-align: top;">Current Track Map:</label>
                     <div style="display: inline-block; vertical-align: top;">
                        <img id="track_map_preview" src="" alt="Track Map" style="max-width: 300px; max-height: 200px; border: 1px solid white; background: white;">
                     </div>
                  </div>
                  <div class="form-row" style="margin-left: 20px; text-align: left;">
                     <label for="track_map_upload">Upload File:</label>
                     <input type="file" id="track_map_upload" accept="image/png" style="width: auto;">
                  </div>
                  <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
                     <button class="modal-btn" id="save_track_btn">Save</button>
                     <button class="modal-btn error" id="cancel_track_btn" style="margin-left: 10px;">Cancel</button>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   </div>

   <!-- Modal Popup -->
   <div id="modal-overlay" class="modal-overlay">
      <div class="modal-container">
         <div class="modal-icon" id="modal-icon">‚ÑπÔ∏è</div>
         <h2 class="modal-title" id="modal-title">Notification</h2>
         <p class="modal-message" id="modal-message">Message goes here</p>
         <button class="modal-btn" id="modal-btn">OK</button>
      </div>
   </div>

   <!-- Confirmation Modal -->
   <div id="confirm-modal-overlay" class="modal-overlay">
      <div class="modal-container">
         <div class="modal-icon">‚ö†Ô∏è</div>
         <h2 class="modal-title" id="confirm-title">Confirm Action</h2>
         <p class="modal-message" id="confirm-message">Are you sure?</p>
         <div style="display: flex; gap: 15px; justify-content: center;">
            <button class="modal-btn" id="confirm-yes-btn">Yes</button>
            <button class="modal-btn error" id="confirm-no-btn">No</button>
         </div>
      </div>
   </div>

   <!-- Validation Results Modal -->
   <div id="validation_modal_overlay" class="modal-overlay">
      <div class="modal-container" style="background-color: #f09537; max-width: 800px; border-radius: 0; border: 3px solid white;">
         <h2 class="modal-title" style="color: white; text-align: left; margin-left: 20px;">Track Map Validation Results</h2>
         <div class="wrapper" style="background-color: #f09537; color: #000;">

            <div style="margin: 20px; text-align: left; color: white;">
               <h3 style="color: white; margin-bottom: 10px;">Tracks Missing from Tracks List</h3>
               <div id="validation_missing_tracks" style="background: white; padding: 10px; color: black; min-height: 50px; max-height: 200px; overflow-y: auto; border: 1px solid white;">
                  <!-- Will be populated by JavaScript -->
               </div>
            </div>

            <div style="margin: 20px; text-align: left; color: white;">
               <h3 style="color: white; margin-bottom: 10px;">Tracks Missing Track Map Files</h3>
               <div id="validation_missing_files" style="background: white; padding: 10px; color: black; min-height: 50px; max-height: 200px; overflow-y: auto; border: 1px solid white;">
                  <!-- Will be populated by JavaScript -->
               </div>
            </div>

            <div style="margin-top: 20px; margin-right: 20px; text-align: right;">
               <button class="modal-btn" id="validation_ok_btn">OK</button>
            </div>
         </div>
      </div>
   </div>

</body>

</html>
